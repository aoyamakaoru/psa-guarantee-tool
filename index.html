<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PSAåˆ©ç›Šè¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>

<style>
:root{
  --bg:#f5f5f5;
  --card:#fff;
  --text:#111;
  --muted:#666;
  --border:#ddd;
  --primary:#111;
  --ghost:#eee;
}

body{
  font-family:system-ui;
  margin:0;
  padding:16px;
  background:var(--bg);
  color:var(--text);
}

.wrap{ margin:auto; }

.view-mobile .wrap{ width:390px; margin:auto; }
.view-pc .wrap{ max-width:900px; margin:auto; }

h1{
  font-size:20px;
  margin:0 0 10px;
}

/* ä¸Šã®ãƒãƒ¼ï¼ˆæŠ¼ã—ã‚„ã™ãï¼‰ */
.viewbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  margin-bottom:12px;
  padding:10px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  position:sticky;
  top:10px;
  z-index:10;
}

.leftBtns{ display:flex; gap:8px; }

.segbtn{
  padding:10px 14px;
  border-radius:14px;
  border:none;
  background:#ddd;
  font-size:15px;
}

.segbtn.active{
  background:var(--primary);
  color:#fff;
}

button{
  padding:10px 14px;
  border-radius:14px;
  border:none;
  font-size:15px;
}

.primary{ background:var(--primary); color:#fff; }
.ghost{ background:var(--ghost); }

/* å…¥åŠ›ï¼ˆã‚¹ãƒãƒ›ã§ãƒ‡ã‚«æŠ¼ã—ï¼‰ */
input{
  width:100%;
  padding:14px;
  margin-bottom:10px;
  border-radius:14px;
  border:1px solid #ccc;
  font-size:18px;
  background:#fff;
}

label{
  display:block;
  font-size:13px;
  color:var(--muted);
  margin:6px 0 6px;
}

.grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
}

@media (max-width:720px){
  .grid{ grid-template-columns:1fr; }
}

/* çµæœ */
.out{
  margin-top:12px;
  padding:14px;
  border-radius:16px;
  background:var(--card);
  border:1px solid var(--border);
}

.big{
  font-size:20px;
  font-weight:800;
  margin-bottom:6px;
}

.sub{
  color:var(--muted);
  font-size:13px;
  margin-top:6px;
}

.ok{ color:#0b6b2a; }
.warn{ color:#b00020; }

/* ã‚¹ãƒãƒ›è¡¨ç¤ºã‚’â€œãã‚Œã£ã½ãâ€è¦‹ã›ãŸã„å ´åˆï¼ˆä»»æ„æ„Ÿï¼‰ */
.view-mobile{
  background:#e9e9e9;
}
.view-mobile .wrap{
  background:transparent;
}

</style>
</head>

<body class="view-mobile">
<div class="wrap">

<h1>PSAåˆ©ç›Šè¨ˆç®—ãƒ„ãƒ¼ãƒ«</h1>

<div class="viewbar">
  <div class="leftBtns">
    <button id="btnMobile" class="segbtn active">ğŸ“± ã‚¹ãƒãƒ›</button>
    <button id="btnPC" class="segbtn">ğŸ–¥ PC</button>
    <button id="fillBtn" class="ghost">âœ¨ ä¾‹</button>
  </div>
  <button id="copyBtn" class="primary">ğŸ“‹ çµæœã‚³ãƒ”ãƒ¼</button>
</div>

<div class="grid">
  <div>
    <label>ã‚«ãƒ¼ãƒ‰ä»£ï¼ˆ1æšã‚ãŸã‚Šï¼‰</label>
    <input id="card" type="number" placeholder="ä¾‹: 3000">
  </div>
  <div>
    <label>é‘‘å®šè²»ç”¨ï¼ˆ1æšã‚ãŸã‚Šï¼‰</label>
    <input id="grading" type="number" placeholder="ä¾‹: 2500">
  </div>
  <div>
    <label>æšæ•°</label>
    <input id="n" type="number" placeholder="ä¾‹: 10">
  </div>
  <div>
    <label>PSA10ç‡ï¼ˆ%ï¼‰</label>
    <input id="rate10" type="number" placeholder="ä¾‹: 60">
  </div>
  <div>
    <label>PSA10è²·å–ï¼ˆ1æšã‚ãŸã‚Šï¼‰</label>
    <input id="p10" type="number" placeholder="ä¾‹: 12000">
  </div>
  <div>
    <label>PSA9è²·å–ï¼ˆ1æšã‚ãŸã‚Šï¼‰</label>
    <input id="p9" type="number" placeholder="ä¾‹: 6000">
  </div>
  <div style="grid-column:1/-1">
    <label>ç›®æ¨™åˆ©ç›Šï¼ˆåˆè¨ˆï¼‰</label>
    <input id="target" type="number" placeholder="ä¾‹: 0ï¼ˆæç›Šåˆ†å²ãªã‚‰0ï¼‰">
  </div>
</div>

<div id="out" class="out">å…¥åŠ›ã™ã‚‹ã¨è‡ªå‹•ã§çµæœãŒå‡ºã¾ã™ã€‚</div>

</div>

<script>
function yen(x){
  if(!isFinite(x)) return "â€”";
  return Math.round(x).toLocaleString("ja-JP");
}

function calc(){
  const c = Number(document.getElementById('card').value) || 0;
  const g = Number(document.getElementById('grading').value) || 0;
  const n = Math.max(1, Math.floor(Number(document.getElementById('n').value) || 1));
  const r10 = Number(document.getElementById('rate10').value) || 0;
  const p10 = Number(document.getElementById('p10').value) || 0;
  const p9 = Number(document.getElementById('p9').value) || 0;
  const target = Number(document.getElementById('target').value) || 0;

  const cost = c + g;
  const diff = p10 - p9;

  // PSA9ã®æœ€å¤§è¨±å®¹æšæ•°ï¼ˆæ•´æ•°ï¼‰
  let yMax;
  if(diff <= 0){
    yMax = n;
  } else {
    const profitAll10 = n * p10 - n * cost;
    yMax = Math.floor((profitAll10 - target) / diff);
    yMax = Math.max(0, Math.min(n, yMax));
  }

  const min10 = n - yMax;
  const needRate = (min10 / n * 100);

  // æœŸå¾…å€¤ï¼ˆç«¯æ•°ã‚ã‚Šï¼‰
  const exp10 = n * (Math.max(0, Math.min(100, r10)) / 100);
  const exp9  = n - exp10;
  const expProfit = exp10 * p10 + exp9 * p9 - n * cost;

  const ok = expProfit >= target;

  document.getElementById('out').innerHTML = `
    <div class="big ${ok ? 'ok':'warn'}">
      ${ok ? 'âœ…' : 'âš ï¸'} PSA9ã¯ <b>${yMax}</b>æšã¾ã§OK
    </div>
    <div>å¿…è¦PSA10æšæ•°ï¼š<b>${min10}</b>æšï¼ˆå¿…è¦PSA10ç‡ï¼š<b>${needRate.toFixed(1)}%</b>ï¼‰</div>
    <div>æœŸå¾…åˆ©ç›Šï¼š<b>${yen(expProfit)}</b>å††ï¼ˆç›®æ¨™ï¼š${yen(target)}å††ï¼‰</div>
    <div class="sub">â€»å…¥åŠ›ã—ãŸPSA10ç‡ã¯æœŸå¾…å€¤ï¼ˆç«¯æ•°ã‚ã‚Šï¼‰ã§ã™ã€‚å®Ÿéš›ã¯æ•´æ•°æšã«ãªã‚Šã¾ã™ã€‚</div>
  `;
}

// è‡ªå‹•è¨ˆç®—ï¼ˆå…¥åŠ›ã™ã‚‹ã ã‘ã§åæ˜ ï¼‰
['card','grading','n','rate10','p10','p9','target'].forEach(id=>{
  document.getElementById(id).addEventListener('input', calc);
});

// ä¾‹
document.getElementById('fillBtn').addEventListener('click', () => {
  document.getElementById('card').value = 3000;
  document.getElementById('grading').value = 2500;
  document.getElementById('n').value = 10;
  document.getElementById('rate10').value = 60;
  document.getElementById('p10').value = 12000;
  document.getElementById('p9').value = 6000;
  document.getElementById('target').value = 0;
  calc();
});

// ã‚³ãƒ”ãƒ¼ï¼ˆã§ããªã„ç’°å¢ƒã‚‚ã‚ã‚‹ã®ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»˜ãï¼‰
document.getElementById('copyBtn').addEventListener('click', async () => {
  const text = document.getElementById('out').innerText;
  try{
    await navigator.clipboard.writeText(text);
    alert("ã‚³ãƒ”ãƒ¼ã—ãŸã§ğŸ‘");
  }catch(e){
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šé¸æŠã—ã¦ã‚³ãƒ”ãƒ¼
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    alert("ã‚³ãƒ”ãƒ¼ã—ãŸã§ğŸ‘");
  }
});

// è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆï¼ˆactiveã‚‚ä»˜ã‘æ›¿ãˆï¼‰
const btnMobile = document.getElementById('btnMobile');
const btnPC = document.getElementById('btnPC');

btnMobile.addEventListener('click', () => {
  document.body.className = "view-mobile";
  btnMobile.classList.add("active");
  btnPC.classList.remove("active");
});
btnPC.addEventListener('click', () => {
  document.body.className = "view-pc";
  btnPC.classList.add("active");
  btnMobile.classList.remove("active");
});

// åˆå›ã‚‚è¨ˆç®—ï¼ˆç©ºã§ã‚‚â€œæ¡ˆå†…â€ãŒå‡ºã‚‹ï¼‰
calc();
</script>

</body>
</html>
